# ç›®å½•ç»“æ„æ•´ç†å˜æ›´è®°å½•

## æ—¥æœŸ
2025-12-03

## é—®é¢˜
ä¹‹å‰çš„è®¾è®¡æœ‰ä¸¤ä¸ª `data` ç›®å½•ï¼š
- `data/` - é¡¹ç›®æ ¹ï¼Œå­˜æ”¾è¯åº“æºå’Œæ‰©å±•è¯åº“
- `pinhan/data/dicts/` - åŒ…å†…ï¼Œå­˜æ”¾ç¼–è¯‘åçš„è¯å…¸

è¿™æ ·å®¹æ˜“æ··æ·†ï¼Œä¸” pip å®‰è£…æ—¶éš¾ä»¥å¤„ç†ã€‚

## è§£å†³æ–¹æ¡ˆ

**ç»Ÿä¸€æ•°æ®å±‚åˆ°é¡¹ç›®æ ¹ `data/` ç›®å½•**ï¼š

```
PinHan/
â”œâ”€â”€ data/                      # ğŸ”‘ å”¯ä¸€çš„æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ dicts/                 # âœ… ç¼–è¯‘åçš„è¯å…¸ï¼ˆè¿è¡Œæ—¶åŠ è½½ï¼‰
â”‚   â”œâ”€â”€ extensions/            # ç”¨æˆ·æ‰©å±•è¯åº“ï¼ˆä¼˜å…ˆçº§40ï¼‰
â”‚   â””â”€â”€ sources/               # ç¬¬ä¸‰æ–¹è¯åº“æºï¼ˆä¼˜å…ˆçº§30ï¼‰
â””â”€â”€ pinhan/                    # âœ¨ åŒ…å†…åªæœ‰ä»£ç ï¼Œæ— æ•°æ®
    â”œâ”€â”€ engine/
    â”œâ”€â”€ api/
    â””â”€â”€ cli.py
```

## å˜æ›´å†…å®¹

### 1. æ–‡ä»¶ç§»åŠ¨

**è¿ç§»è¯å…¸æ–‡ä»¶**ï¼š
```
pinhan/data/dicts/* â†’ data/dicts/*
```

- âŒ åˆ é™¤ï¼š`pinhan/data/` ç›®å½•
- âœ… ç›®æ ‡ï¼š`data/dicts/` å·²åŒ…å«æ‰€æœ‰è¯å…¸æ–‡ä»¶

### 2. ä»£ç æ›´æ–°

**core.py** (`pinhan/engine/core.py`)
- ä¿®æ”¹å‚æ•°ï¼š`model_dir` â†’ `dicts_dir`
- æ›´æ–°è·¯å¾„æŸ¥æ‰¾é€»è¾‘ï¼šè‡ªåŠ¨æŸ¥æ‰¾ `../../../data/dicts/`

```python
def __init__(self, config=None, dicts_dir=None):
    if dicts_dir is None:
        pkg_dir = os.path.dirname(os.path.dirname(__file__))
        root_dir = os.path.dirname(pkg_dir)
        dicts_dir = os.path.join(root_dir, 'data', 'dicts')
    self.dicts_dir = dicts_dir
```

**engine/__init__.py**
- æ›´æ–°å·¥å‚å‡½æ•°ç­¾åï¼š`model_dir` â†’ `dicts_dir`

**api/server.py**
- ç®€åŒ–åˆå§‹åŒ–ï¼š`create_engine_v3(config)` è‡ªåŠ¨æŸ¥æ‰¾è¯å…¸

### 3. é…ç½®æ›´æ–°

**pyproject.toml**
- wheel åŒ…å«ï¼š`data/dicts/*.json`, `data/dicts/*.txt`
- sdist åŒ…å«ï¼š`data/dicts/`, `scripts/`

```toml
[tool.hatch.build.targets.wheel]
include = [
    "data/dicts/*.json",
    "data/dicts/*.txt",
]
```

**build_dict.py**
- è·¯å¾„å·²æ­£ç¡®ï¼š`data/` â†’ è¾“å‡º â†’ `data/dicts/`
- æ›´æ–°æ–‡æ¡£è¯´æ˜

**.gitignore**
- æ›´æ–°è§„åˆ™ï¼šå¿½ç•¥ `data/sources/SUBTLEX-CH/`ï¼Œä¿ç•™ `data/dicts/`
- ä¿ç•™ï¼š`data/extensions/`ï¼ˆç”¨æˆ·æ–‡ä»¶ï¼‰

### 4. æ–‡æ¡£æ›´æ–°

**README.md**
- æ›´æ–°"é¡¹ç›®ç»“æ„"ç« èŠ‚
- æ›´æ–°"è¯åº“å®šåˆ¶æŒ‡å—"è¯´æ˜æ–°ä½ç½®
- æ¾„æ¸…æ•°æ®å±‚ä¸åº”ç”¨å±‚åˆ†ç¦»

**DIRECTORY_STRUCTURE.md**ï¼ˆæ–°å¢ï¼‰
- è¯¦ç»†è¯´æ˜ç›®å½•èŒè´£
- å·¥ä½œæµè¯´æ˜
- ä½¿ç”¨æŒ‡å—
- è¿ç§»æ¸…å•

## æµ‹è¯•éªŒè¯

âœ… **åŠŸèƒ½æµ‹è¯•**ï¼š
```
è¯å…¸è·¯å¾„: C:\Users\Li\Desktop\PinHan\data\dicts
è¯å…¸æ–‡ä»¶: 5 (char_dict.json, word_dict.json, ...)
æµ‹è¯•: IMEEngineV3 â†’ process('zhongguoren') â†’ 'ä¸­å›½äºº' âœ“
```

âœ… **è·¯å¾„æŸ¥æ‰¾**ï¼š
- æœ¬åœ°å¼€å‘ï¼šè‡ªåŠ¨æ‰¾åˆ° `../../../data/dicts/` âœ“
- åŒ…å†…æ—  data ç›®å½• âœ“

## å½±å“èŒƒå›´

### ç”¨æˆ·ï¼ˆä½¿ç”¨åº“ï¼‰
- âœ… æ— å˜åŒ–ï¼š`from pinhan import IMEEngineV3; engine = IMEEngineV3()` ä»ç„¶å·¥ä½œ
- âš ï¸ æ·»åŠ çƒ­è¯ï¼šç°åœ¨åœ¨ `data/extensions/` è€Œä¸æ˜¯ `pinhan/data/extensions/`

### å¼€å‘è€…ï¼ˆä¿®æ”¹ä»£ç ï¼‰
- âš ï¸ å‚æ•°åï¼š`model_dir` â†’ `dicts_dir`ï¼ˆå¦‚æœ‰è‡ªå®šä¹‰è°ƒç”¨ï¼‰
- âœ… å…¶ä»–ä»£ç æ— éœ€ä¿®æ”¹

### éƒ¨ç½²ï¼ˆDocker/pipï¼‰
- âœ… Dockerï¼šè‡ªåŠ¨åŒ…å« `data/dicts/`
- âœ… pipï¼šwheel åŒ…å«è¯å…¸ï¼Œæ— é¢å¤–é…ç½®

## ä¼˜ç‚¹

| ä¼˜ç‚¹ | è¯´æ˜ |
|------|------|
| æ¸…æ™° | æ•°æ®å’Œä»£ç åˆ†ç¦»ï¼Œç»“æ„æ˜ç¡® |
| å¯ç»´æŠ¤ | è¯åº“æºã€çƒ­è¯ã€ç¼–è¯‘è¾“å‡ºå„å¸å…¶èŒ |
| å¯æ‰©å±• | è½»æ¾æ·»åŠ ç¬¬ä¸‰æ–¹è¯åº“å’Œçƒ­è¯ |
| å¯éƒ¨ç½² | pip å®‰è£…æ—¶è¯å…¸è‡ªåŠ¨åŒ…å« |
| çµæ´» | æ”¯æŒè‡ªå®šä¹‰è¯å…¸è·¯å¾„ |

## è¿ç§»æ­¥éª¤ï¼ˆå·²å®Œæˆï¼‰

- âœ… å¤åˆ¶ `pinhan/data/dicts/*` â†’ `data/dicts/`
- âœ… åˆ é™¤ `pinhan/data/` ç›®å½•
- âœ… æ›´æ–° core.py è·¯å¾„æŸ¥æ‰¾
- âœ… æ›´æ–° engine/__init__.py å·¥å‚å‡½æ•°
- âœ… æ›´æ–° api/server.py åˆå§‹åŒ–
- âœ… æ›´æ–° pyproject.toml æ‰“åŒ…é…ç½®
- âœ… æ›´æ–° .gitignore è§„åˆ™
- âœ… æ›´æ–° README.md
- âœ… æ–°å¢ DIRECTORY_STRUCTURE.md
- âœ… éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

## åç»­è®¡åˆ’

1. **pip å‘å¸ƒ**ï¼šç¡®ä¿è¯å…¸æ­£ç¡®æ‰“åŒ…ï¼ˆå·²é…ç½®ï¼‰
2. **Docker é•œåƒ**ï¼šéªŒè¯è¯å…¸åœ¨å®¹å™¨ä¸­æ­£ç¡®åŠ è½½
3. **è¯åº“æ›´æ–°**ï¼šç”¨æˆ·å¯ç›´æ¥ç¼–è¾‘ `data/extensions/hotwords.txt`

---

**æ€»ç»“**ï¼šé¡¹ç›®ç°å·²é‡‡ç”¨æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œæ•°æ®å’Œä»£ç åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚
